<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Story</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #000; overflow: hidden; }
        .canvas { width: 1024px; height: 576px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .elem { position: absolute; }
        .elem img, .elem video { width: 100%; height: 100%; object-fit: cover; }
        .elem-text { padding: 15px; border-radius: 6px; text-align: center; }
        .elem-button { padding: 15px 30px; border-radius: 6px; font-weight: 700; font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .elem-timer { background: rgba(247,147,26,0.8); color: #fff; font-size: 3rem; font-weight: 900; display: flex; align-items: center; justify-content: center; border-radius: 8px; font-family: monospace; }
        .elem-draggable { cursor: grab; display: flex; align-items: center; justify-content: center; user-select: none; }
        .elem-draggable:active { cursor: grabbing; }
        .elem-draggable img { width: 100%; height: 100%; object-fit: contain; pointer-events: none; }
        .elem-hotspot-visible { border: 3px dashed rgba(255,0,0,0.5); background: rgba(255,0,0,0.05); }
        .inventory-display { position: fixed; bottom: 20px; left: 20px; background: rgba(0,0,0,0.8); padding: 10px; border-radius: 8px; display: flex; gap: 10px; }
        .trans-fade { animation: fadeIn 0.5s ease-in forwards; }
        .trans-fade-out { animation: fadeOut 0.5s ease-out forwards; }
        .trans-slideLeft { animation: slideLeft 0.5s ease-out forwards; }
        .trans-slideLeft-out { animation: slideLeftOut 0.5s ease-in forwards; }
        .trans-slideRight { animation: slideRight 0.5s ease-out forwards; }
        .trans-slideRight-out { animation: slideRightOut 0.5s ease-in forwards; }
        .trans-slideUp { animation: slideUp 0.5s ease-out forwards; }
        .trans-slideUp-out { animation: slideUpOut 0.5s ease-in forwards; }
        .trans-slideDown { animation: slideDown 0.5s ease-out forwards; }
        .trans-slideDown-out { animation: slideDownOut 0.5s ease-in forwards; }
        .trans-zoom { animation: zoomIn 0.5s ease-out forwards; }
        .trans-zoom-out { animation: zoomOut 0.5s ease-in forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        @keyframes slideLeft { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideLeftOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(-100%); opacity: 0; } }
        @keyframes slideRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideRightOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
        @keyframes slideUp { from { transform: translateY(-100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideUpOut { from { transform: translateY(0); opacity: 1; } to { transform: translateY(-100%); opacity: 0; } }
        @keyframes slideDown { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideDownOut { from { transform: translateY(0); opacity: 1; } to { transform: translateY(100%); opacity: 0; } }
        @keyframes zoomIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes zoomOut { from { transform: scale(1); opacity: 1; } to { transform: scale(0); opacity: 0; } }
    </style>
</head>
<body>
    <div id="game" class="canvas"></div>
    <div id="inventory" class="inventory-display" style="display:none"></div>
    <script>
const STEPS = [{"id":"intro","title":"intro","elements":[{"id":"audio_1768029782336","type":"audio","label":"audio1","x":0,"y":0,"width":200,"height":60,"content":"http://satmis.hirakatajin.com/Lost at the beachyo.mp3.mp3","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":true,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"text_1768030402684","type":"text","label":"text1","x":225.33659730722147,"y":12.264381884944981,"width":634.4724602203182,"height":122.82496940024481,"content":"Satoshi's Mission","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"zoom","transitionDuration":1,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":70},{"id":"image_1768030796552","type":"image","label":"image2","x":100,"y":100,"width":400,"height":300,"content":"","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"video_1768031494371","type":"video","label":"video1","x":0,"y":0,"width":1024,"height":576,"content":"http://satmis.hirakatajin.com/intro.mp4","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":true,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"text_1768031587254","type":"text","label":"text2","x":346.9130966952264,"y":162.66829865361072,"width":392.5728274173806,"height":106.53121175030603,"content":"How will you try to get food?","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"button_1768031615655","type":"button","label":"button2","x":7.250917992656065,"y":508.5973072215425,"width":300,"height":60,"content":"Make a phone call ðŸ“±","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#e32400","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"button_1768031616338","type":"button","label":"button3","x":364.46022031823776,"y":509.8506731946146,"width":300,"height":60,"content":"Try to make money ðŸ’´","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#e32400","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"button_1768031616954","type":"button","label":"button4","x":715.2264381884949,"y":509.8506731946146,"width":300,"height":60,"content":"Search trash cans ðŸš®","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#e32400","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"image_1768030348368","type":"image","label":"image1","x":417.10159118727034,"y":112.80293757649946,"width":319.87760097919215,"height":427.3929008567932,"content":"http://satmis.hirakatajin.com/satinto.jpg","visible":true,"layer":1,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"slideRight","transitionDuration":1,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"button_1768030721803","type":"button","label":"button1","x":93.73317013463881,"y":279.2313341493269,"width":300,"height":60,"content":"Start Mission","visible":true,"layer":2,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24}],"events":[{"id":"event_1768030626469","trigger":{"type":"onLoad","delay":0,"sourceElement":""},"condition":null,"actions":[{"id":"action_1768030628818","type":"hide","target":"","value":"","targets":["text_1768030402684","button_1768031615655","button_1768031616338","button_1768031616954","text_1768031587254","video_1768031494371","button_1768030721803"]}]},{"id":"event_1768030634086","trigger":{"type":"afterDelay","delay":3,"sourceElement":""},"condition":null,"actions":[{"id":"action_1768030639802","type":"show","target":"","value":"","targets":["text_1768030402684"]}]},{"id":"event_1768043081061","trigger":{"type":"onClick","delay":0,"sourceElement":"button_1768030721803"},"condition":null,"actions":[{"id":"action_1768043098261","type":"hide","target":"","value":"","targets":["button_1768030721803","image_1768030348368","image_1768030796552","text_1768030402684"]},{"id":"action_1768043264146","type":"showDelay","target":"","value":"","delay":1,"targets":["video_1768031494371"]},{"id":"action_1768043296396","type":"showDelay","target":"","value":"","delay":12,"targets":["text_1768031587254","button_1768031615655","button_1768031616338","button_1768031616954"]}]},{"id":"event_1768043361763","trigger":{"type":"afterDelay","delay":5,"sourceElement":""},"condition":null,"actions":[{"id":"action_1768043374513","type":"show","target":"","value":"","targets":["button_1768030721803"]}]},{"id":"event_1768043545514","trigger":{"type":"onClick","delay":0,"sourceElement":"button_1768031615655"},"condition":null,"actions":[{"id":"action_1768043552846","type":"goto","target":"","value":"","targets":["make_call"]}]},{"id":"event_1768043563080","trigger":{"type":"onClick","delay":0,"sourceElement":"button_1768031616338"},"condition":null,"actions":[{"id":"action_1768043572563","type":"goto","target":"","value":"","targets":["make_money"]}]},{"id":"event_1768043587714","trigger":{"type":"onClick","delay":0,"sourceElement":"button_1768031616954"},"condition":null,"actions":[{"id":"action_1768043595880","type":"goto","target":"","value":"","targets":["search_trash"]}]}],"password":"","wrongPasswordStep":"","bgColor":"#000000","bgShapes":[]},{"id":"make_call","title":"make call","elements":[{"id":"text_1768043761982","type":"text","label":"text1","x":280.48470012239886,"y":42.34516523867806,"width":460.2545899632801,"height":102.7711138310894,"content":"Who will you call?","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":55},{"id":"image_1768043991066","type":"image","label":"image1","x":43.59853121175028,"y":187.73561811505496,"width":267.2362301101591,"height":290.77600979192175,"content":"http://satmis.hirakatajin.com/mom2.PNG","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"image_1768043991566","type":"image","label":"image2","x":371.98041615667114,"y":197.76254589963327,"width":270.99632802937583,"height":290.77600979192164,"content":"http://satmis.hirakatajin.com/yakiko.PNG","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"image_1768043992049","type":"image","label":"image3","x":702.8690330477349,"y":196.50917992656065,"width":267.2362301101599,"height":290.7760097919215,"content":"http://satmis.hirakatajin.com/satomaru.PNG","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"button_1768044261351","type":"button","label":"button1","x":31.334149326805395,"y":493.4394124847001,"width":300,"height":60,"content":"call mom","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"button_1768044261900","type":"button","label":"button2","x":363.2068543451653,"y":496.06364749082024,"width":300,"height":60,"content":"call ex-girlfriend","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"button_1768044262416","type":"button","label":"button3","x":689.0820073439396,"y":495.9461444308445,"width":300,"height":60,"content":"call friend","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24}],"events":[{"id":"event_1768044403849","trigger":{"type":"onClick","delay":0,"sourceElement":"button_1768044261351"},"condition":null,"actions":[{"id":"action_1768044419183","type":"goto","target":"","value":"","targets":["call_mom"]}]},{"id":"event_1768044407216","trigger":{"type":"onClick","delay":0,"sourceElement":"button_1768044261900"},"condition":null,"actions":[{"id":"action_1768044429950","type":"goto","target":"","value":"","targets":["call_ex"]}]},{"id":"event_1768044409917","trigger":{"type":"onClick","delay":0,"sourceElement":"button_1768044262416"},"condition":null,"actions":[{"id":"action_1768044442467","type":"goto","target":"","value":"","targets":["call_friend"]}]},{"id":"event_1768044533167","trigger":{"type":"onLoad","delay":0,"sourceElement":""},"condition":{"type":"hasItem","item":"got advice"},"actions":[{"id":"action_1768044575467","type":"hide","target":"","value":"","targets":["image_1768043991066","button_1768044261351"]}]}],"password":"","wrongPasswordStep":"","bgColor":"#ebebeb","bgShapes":[]},{"id":"call_mom","title":"call mom","elements":[{"id":"image_1768043749564","type":"image","label":"image1","x":0,"y":0,"width":1024,"height":576,"content":"http://satmis.hirakatajin.com/mom1.jpg","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"audio_1768044867386","type":"audio","label":"Audio 1","x":28.5581395348837,"y":54.87882496940023,"width":200,"height":60,"content":"https://raw.githubusercontent.com/TheDepression/Sounds/main/fvc.mp3","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":true,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"audio_1768044868201","type":"audio","label":"audio2","x":16.024479804161594,"y":155.14810281517757,"width":200,"height":60,"content":"http://satmis.hirakatajin.com/Hello Satoshi.mp3","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":true,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"audio_1768044868736","type":"audio","label":"audio3","x":16.024479804161565,"y":252.91064871481018,"width":200,"height":60,"content":"http://satmis.hirakatajin.com/Advice.mp3","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":true,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"text_1768044877434","type":"text","label":"text1","x":651.4810281517739,"y":42.34516523867804,"width":300,"height":100,"content":"Hello Satoshi??","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":44},{"id":"text_1768044877952","type":"text","label":"text2","x":549.7821297429625,"y":171.44186046511618,"width":467.951040391676,"height":117.81150550795604,"content":"I'm Sorry - but I'm going on a trip to Mexico. But if you'd like, I can give you some advice..","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":40},{"id":"button_1768044884186","type":"button","label":"button1","x":380.7539779681763,"y":433.3953488372093,"width":300,"height":60,"content":"Hi Mom.... I am hungry. Can you bring me some food?","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#0056d6","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"button_1768044884886","type":"button","label":"button2","x":387.0208078335369,"y":455.95593635250907,"width":300,"height":60,"content":"Ummm... ok.. sure..","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#0056d6","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24}],"events":[{"id":"event_1768044911319","trigger":{"type":"onLoad","delay":0,"sourceElement":""},"condition":null,"actions":[{"id":"action_1768044912836","type":"hide","target":"","value":"","targets":["image_1768043749564","audio_1768044868201","audio_1768044868736","text_1768044877434","text_1768044877952","button_1768044884186","button_1768044884886"]}]},{"id":"event_1768044948852","trigger":{"type":"afterDelay","delay":3,"sourceElement":""},"condition":null,"actions":[{"id":"action_1768044954287","type":"show","target":"","value":"","targets":["image_1768043749564","audio_1768044868201"]},{"id":"action_1768044963653","type":"hide","target":"","value":"","targets":["audio_1768044867386"]},{"id":"action_1768045381409","type":"showDelay","target":"","value":"","delay":5.5,"targets":["button_1768044884186"]}]},{"id":"event_1768045453408","trigger":{"type":"afterDelay","delay":3.5,"sourceElement":""},"condition":null,"actions":[{"id":"action_1768045462808","type":"show","target":"","value":"","targets":["text_1768044877434"]}]},{"id":"event_1768045484325","trigger":{"type":"onClick","delay":0,"sourceElement":"button_1768044884186"},"condition":null,"actions":[{"id":"action_1768045493225","type":"hide","target":"","value":"","targets":["audio_1768044868201","text_1768044877434","button_1768044884186"]},{"id":"action_1768045528891","type":"show","target":"","value":"","targets":["audio_1768044868736","text_1768044877952"]},{"id":"action_1768045543608","type":"showDelay","target":"","value":"","delay":11.4,"targets":["button_1768044884886"]}]},{"id":"event_1768045641124","trigger":{"type":"onClick","delay":0,"sourceElement":"button_1768044884886"},"condition":null,"actions":[{"id":"action_1768045648490","type":"goto","target":"","value":"","targets":["mom_advice_mario","mom_advice_cowboy","mom_advice_yakiko","mom_advice_rabbit","mom_advice_dr","mom_advice_restaurant"]}]}],"password":"","wrongPasswordStep":"","bgColor":"#000000","bgShapes":[]},{"id":"mom_advice_mario","title":"mom advice mario","elements":[{"id":"image_1768043722214","type":"image","label":"image1","x":0,"y":0,"width":1024,"height":576,"content":"http://satmis.hirakatajin.com/mom1.jpg","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"audio_1768045882956","type":"audio","label":"audio1","x":100,"y":100,"width":200,"height":60,"content":"http://satmis.hirakatajin.com/Code.mp3","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":true,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"text_1768045951806","type":"text","label":"text1","x":543.6915544675645,"y":47.358629130967074,"width":447.7209302325584,"height":136.61199510403907,"content":"I saw the word \"Mario\" written on a napkin. I wonder if that's some kind of password or something..","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":44},{"id":"button_1768045991772","type":"button","label":"button1","x":400.8078335373318,"y":452.1958384332925,"width":300,"height":60,"content":"Ummm... ok.. Thanks for the \"advice\"...  bye","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24}],"events":[{"id":"event_1768046909850","trigger":{"type":"onLoad","delay":0,"sourceElement":""},"condition":null,"actions":[{"id":"action_1768046923817","type":"hide","target":"","value":"","targets":["button_1768045991772"]}]},{"id":"event_1768046992315","trigger":{"type":"afterDelay","delay":11,"sourceElement":""},"condition":null,"actions":[{"id":"action_1768046998182","type":"show","target":"","value":"","targets":["button_1768045991772"]}]},{"id":"event_1768047747246","trigger":{"type":"onClick","delay":0,"sourceElement":"button_1768045991772"},"condition":null,"actions":[{"id":"action_1768047755345","type":"goto","target":"","value":"","targets":["got_advice"]}]}],"password":"","wrongPasswordStep":"","bgColor":"#000000","bgShapes":[]},{"id":"mom_advice_cowboy","title":"mom advice cowboy","elements":[{"id":"image_1768043719264","type":"image","label":"image1","x":0,"y":0,"width":1024,"height":576,"content":"http://satmis.hirakatajin.com/mom1.jpg","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"audio_1768045888273","type":"audio","label":"audio1","x":100,"y":100,"width":200,"height":60,"content":"http://satmis.hirakatajin.com/Cowboy.mp3","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":true,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"text_1768045945905","type":"text","label":"text1","x":531.1578947368422,"y":78.69277845777233,"width":490.3353733170135,"height":116.55813953488376,"content":"Stay away from that cowboy's house... He's a dangerous man.","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":44},{"id":"button_1768045996805","type":"button","label":"button1","x":409.58139534883725,"y":459.7160342717259,"width":300,"height":60,"content":"Ummm... ok.. Thanks for the \"advice\"...  bye","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24}],"events":[{"id":"event_1768046939317","trigger":{"type":"onLoad","delay":0,"sourceElement":""},"condition":null,"actions":[{"id":"action_1768046941050","type":"hide","target":"","value":"","targets":["button_1768045996805"]}]},{"id":"event_1768047025349","trigger":{"type":"afterDelay","delay":9,"sourceElement":""},"condition":null,"actions":[{"id":"action_1768047029765","type":"show","target":"","value":"","targets":["button_1768045996805"]}]},{"id":"event_1768047791578","trigger":{"type":"onClick","delay":0,"sourceElement":"button_1768045996805"},"condition":null,"actions":[{"id":"action_1768047799979","type":"goto","target":"","value":"","targets":["got_advice"]}]}],"password":"","wrongPasswordStep":"","bgColor":"#000000","bgShapes":[]},{"id":"mom_advice_yakiko","title":"mom advice yakiko","elements":[{"id":"image_1768043716214","type":"image","label":"image1","x":0,"y":0,"width":1024,"height":576,"content":"http://satmis.hirakatajin.com/mom1.jpg","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"audio_1768045892089","type":"audio","label":"audio1","x":100,"y":100,"width":200,"height":60,"content":"http://satmis.hirakatajin.com/Yakiban.mp3","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":true,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"text_1768045940289","type":"text","label":"text1","x":568.7588739290077,"y":77.43941248470004,"width":420.14687882497014,"height":130.3451652386782,"content":"Yakiko does not like bananas","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":44},{"id":"button_1768046001238","type":"button","label":"button1","x":388.2741738066097,"y":454.70257037943696,"width":300,"height":60,"content":"Ummm... ok.. Thanks for the \"advice\"...  bye","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24}],"events":[{"id":"event_1768046950782","trigger":{"type":"onLoad","delay":0,"sourceElement":""},"condition":null,"actions":[{"id":"action_1768046952733","type":"hide","target":"","value":"","targets":["button_1768046001238"]}]},{"id":"event_1768047051149","trigger":{"type":"afterDelay","delay":6,"sourceElement":""},"condition":null,"actions":[{"id":"action_1768047056482","type":"show","target":"","value":"","targets":["button_1768046001238"]}]},{"id":"event_1768047809078","trigger":{"type":"onClick","delay":0,"sourceElement":"button_1768046001238"},"condition":null,"actions":[{"id":"action_1768047816911","type":"goto","target":"","value":"","targets":["got_advice"]}]}],"password":"","wrongPasswordStep":"","bgColor":"#000000","bgShapes":[]},{"id":"mom_advice_rabbit","title":"mom advice rabbit","elements":[{"id":"image_1768043713198","type":"image","label":"image1","x":0,"y":0,"width":1024,"height":576,"content":"http://satmis.hirakatajin.com/mom1.jpg","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"audio_1768045895855","type":"audio","label":"audio1","x":100,"y":100,"width":200,"height":60,"content":"http://satmis.hirakatajin.com/Rabido.mp3","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":true,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"text_1768045935222","type":"text","label":"text1","x":529.9045287637701,"y":91.22643818849441,"width":477.80171358629127,"height":134.1052631578947,"content":"I saw a rabbit eating a donut before I left","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":44},{"id":"button_1768046005739","type":"button","label":"button1","x":417.10159118727057,"y":442.16891064871464,"width":300,"height":60,"content":"Ummm... ok.. Thanks for the \"advice\"...  bye","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24}],"events":[{"id":"event_1768046959599","trigger":{"type":"onLoad","delay":0,"sourceElement":""},"condition":null,"actions":[{"id":"action_1768046961334","type":"hide","target":"","value":"","targets":["button_1768046005739"]}]},{"id":"event_1768047095999","trigger":{"type":"afterDelay","delay":7,"sourceElement":""},"condition":null,"actions":[{"id":"action_1768047100283","type":"show","target":"","value":"","targets":["button_1768046005739"]}]},{"id":"event_1768047833862","trigger":{"type":"onClick","delay":0,"sourceElement":"button_1768046005739"},"condition":null,"actions":[{"id":"action_1768047841744","type":"goto","target":"","value":"","targets":["got_advice"]}]}],"password":"","wrongPasswordStep":"","bgColor":"#000000","bgShapes":[]},{"id":"mom_advice_dr","title":"mom advice dr","elements":[{"id":"image_1768043710780","type":"image","label":"image1","x":0,"y":0,"width":1024,"height":575.0208078335373,"content":"http://satmis.hirakatajin.com/mom1.jpg","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"audio_1768045899355","type":"audio","label":"audio1","x":100,"y":100,"width":200,"height":60,"content":"http://satmis.hirakatajin.com/Drsmith.mp3","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":true,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"text_1768045929556","type":"text","label":"text1","x":543.6915544675651,"y":78.69277845777222,"width":467.77478580171334,"height":149.14565483476136,"content":"Dr. Smith has passed away, sadly.","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":44},{"id":"button_1768046010556","type":"button","label":"button1","x":360.70012239902104,"y":448.43574051407603,"width":300,"height":60,"content":"Ummm... ok.. Thanks for the \"advice\"...  bye","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24}],"events":[{"id":"event_1768046968115","trigger":{"type":"onLoad","delay":0,"sourceElement":""},"condition":null,"actions":[{"id":"action_1768046971050","type":"hide","target":"","value":"","targets":["button_1768046010556"]}]},{"id":"event_1768047113682","trigger":{"type":"afterDelay","delay":7,"sourceElement":""},"condition":null,"actions":[{"id":"action_1768047117519","type":"show","target":"","value":"","targets":["button_1768046010556"]}]},{"id":"event_1768047856611","trigger":{"type":"onClick","delay":0,"sourceElement":"button_1768046010556"},"condition":null,"actions":[{"id":"action_1768047863794","type":"goto","target":"","value":"","targets":["got_advice"]}]}],"password":"","wrongPasswordStep":"","bgColor":"#000000","bgShapes":[]},{"id":"mom_advice_restaurant","title":"mom advice restaurant","elements":[{"id":"image_1768043707298","type":"image","label":"image1","x":0,"y":0,"width":1024,"height":576,"content":"http://satmis.hirakatajin.com/mom1.jpg","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"audio_1768045904023","type":"audio","label":"audio1","x":100,"y":100,"width":200,"height":60,"content":"http://satmis.hirakatajin.com/Resthire.mp3","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":true,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"text_1768045923372","type":"text","label":"text1","x":570.0122399020808,"y":52.372093023255964,"width":442.7074663402691,"height":122.82496940024464,"content":"The restaurant is hiring recently.","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":44},{"id":"button_1768046015405","type":"button","label":"button1","x":420.86168910648735,"y":465.98286413708695,"width":300,"height":60,"content":"Ummm... ok.. Thanks for the \"advice\"...  bye","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24}],"events":[{"id":"event_1768046978550","trigger":{"type":"onLoad","delay":0,"sourceElement":""},"condition":null,"actions":[{"id":"action_1768046979750","type":"hide","target":"","value":"","targets":["button_1768046015405"]}]},{"id":"event_1768047146466","trigger":{"type":"afterDelay","delay":5,"sourceElement":""},"condition":null,"actions":[{"id":"action_1768047151249","type":"show","target":"","value":"","targets":["button_1768046015405"]}]},{"id":"event_1768047873345","trigger":{"type":"onClick","delay":0,"sourceElement":"button_1768046015405"},"condition":null,"actions":[{"id":"action_1768047880861","type":"goto","target":"","value":"","targets":["got_advice"]}]}],"password":"","wrongPasswordStep":"","bgColor":"#000000","bgShapes":[]},{"id":"got_advice","title":"got advice","elements":[{"id":"text_1768047245749","type":"text","label":"text1","x":355.686658506732,"y":32.31823745410034,"width":300,"height":100,"content":"Strange advice... hmm.   What will you do next?","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"button_1768047311248","type":"button","label":"button1","x":383.26070991432067,"y":158.90820073439411,"width":300,"height":60,"content":"Call someone elseðŸ“ž","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"button_1768047312848","type":"button","label":"button2","x":389.5275397796822,"y":306.8053855569159,"width":300,"height":60,"content":"Try to make moneyðŸ’°","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"button_1768047313764","type":"button","label":"button3","x":395.7943696450425,"y":472.24969400244834,"width":300,"height":60,"content":"Search trash cans ðŸ—‘ï¸","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24},{"id":"image_1768047426799","type":"image","label":"image1","x":84.95960832313344,"y":110.02692778457774,"width":257.2093023255814,"height":403.5789473684209,"content":"http://satmis.hirakatajin.com/satinto.jpg","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24}],"events":[{"id":"event_1768047283131","trigger":{"type":"onLoad","delay":0,"sourceElement":""},"condition":null,"actions":[{"id":"action_1768047290332","type":"addItem","target":"got advice","value":""}]},{"id":"event_1768047637530","trigger":{"type":"onClick","delay":0,"sourceElement":"button_1768047311248"},"condition":null,"actions":[{"id":"action_1768047644780","type":"goto","target":"","value":"","targets":["make_call"]}]},{"id":"event_1768047665246","trigger":{"type":"onClick","delay":0,"sourceElement":"button_1768047312848"},"condition":null,"actions":[{"id":"action_1768047671795","type":"goto","target":"","value":"","targets":["make_money"]}]},{"id":"event_1768047685595","trigger":{"type":"onClick","delay":0,"sourceElement":"button_1768047313764"},"condition":null,"actions":[{"id":"action_1768047695046","type":"goto","target":"","value":"","targets":["search_trash"]}]}],"password":"","wrongPasswordStep":"","bgColor":"#000000","bgShapes":[]},{"id":"call_ex","title":"call ex","elements":[{"id":"video_1768043700881","type":"video","label":"video1","x":100,"y":100,"width":400,"height":300,"content":"","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":true,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24}],"events":[],"password":"","wrongPasswordStep":"","bgColor":"#000000","bgShapes":[]},{"id":"call_friend","title":"call friend","elements":[{"id":"video_1768043694197","type":"video","label":"video1","x":100,"y":100,"width":400,"height":300,"content":"","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":true,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24}],"events":[],"password":"","wrongPasswordStep":"","bgColor":"#000000","bgShapes":[]},{"id":"make_money","title":"make money","elements":[{"id":"text_1768043680981","type":"text","label":"text1","x":100,"y":100,"width":300,"height":100,"content":"how will you try to make money","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#ffffff","textBgColor":"rgba(0,0,0,0.8)","textSize":24}],"events":[],"password":"","wrongPasswordStep":"","bgColor":"#000000","bgShapes":[]},{"id":"search_trash","title":"search trash","elements":[{"id":"text_1768043621015","type":"text","label":"text1","x":170.1884944920439,"y":61.14565483476119,"width":707.1676866585067,"height":180.47980416156673,"content":"Which trash cans would you like to search?","visible":true,"layer":0,"duration":0,"loop":false,"autoplay":false,"shape":"rect","color":"#f7931a","countdown":10,"fontSize":24,"contentType":"text","hotspotMode":"both","transition":"none","transitionDuration":0.5,"textColor":"#000000","textBgColor":"#ffffff","textSize":55}],"events":[],"password":"","wrongPasswordStep":"","bgColor":"#ffffff","bgShapes":[]}];
const INVENTORY_ITEMS = [{"name":"got advice","visible":false}];
let current = STEPS[0].id;
let visible = {};
let inventory = [];
let timers = [];
let timerCountdowns = {};
let hiding = {};
let rendered = {};
let draggedElem = null;
let dragOffset = { x: 0, y: 0 };
let dragPos = { x: 0, y: 0 };

function render() {
    timers.forEach(t => clearTimeout(t));
    timers = [];
    timerCountdowns = {};
    hiding = {};
    rendered = {};
    draggedElem = null;
    
    const s = STEPS.find(x => x.id === current);
    if (!s) return;
    
    if (s.password) {
        const pwd = prompt("Password:");
        if (pwd !== s.password) {
            if (s.wrongPasswordStep) { current = s.wrongPasswordStep; render(); return; }
            else { alert("Wrong!"); return; }
        }
    }
    
    visible = {};
    s.elements.forEach(e => {
        visible[e.id] = e.visible;
        if (e.visible && e.duration && e.duration > 0) {
            const t = setTimeout(() => hideElem(e.id), e.duration * 1000);
            timers.push(t);
        }
        if (e.type === "timer" && e.visible) startTimer(e.id, e.countdown);
    });
    
    s.events.forEach(ev => {
        if (checkCond(ev.condition)) {
            if (ev.trigger.type === "onLoad") exec(ev.actions);
            else if (ev.trigger.type === "afterDelay") {
                const t = setTimeout(() => exec(ev.actions), (ev.trigger.delay || 0) * 1000);
                timers.push(t);
            }
        }
    });
    
    fullDraw();
    
    setTimeout(() => {
        const vids = document.querySelectorAll("video");
        vids.forEach(v => {
            const elem = s.elements.find(e => e.content && v.src.includes(e.content));
            if (elem) {
                v.onended = () => {
                    s.events.forEach(ev => {
                        if (ev.trigger.type === "afterElement" && ev.trigger.sourceElement === elem.id && checkCond(ev.condition)) exec(ev.actions);
                    });
                };
            }
        });
    }, 100);
}

function startTimer(id, countdown) {
    let rem = countdown;
    timerCountdowns[id] = rem;
    const int = setInterval(() => {
        rem--;
        timerCountdowns[id] = rem;
        const timerDiv = document.querySelector('[data-elem-id="' + id + '"] .elem-timer');
        if (timerDiv) timerDiv.textContent = rem;
        if (rem <= 0) {
            clearInterval(int);
            const s = STEPS.find(x => x.id === current);
            s.events.forEach(ev => {
                if (ev.trigger.type === "afterElement" && ev.trigger.sourceElement === id && checkCond(ev.condition)) exec(ev.actions);
            });
        }
    }, 1000);
    timers.push(int);
}

function hideElem(id) {
    const s = STEPS.find(x => x.id === current);
    const elem = s.elements.find(e => e.id === id);
    const elemDiv = document.querySelector('[data-elem-id="' + id + '"]');
    
    if (!elemDiv) {
        visible[id] = false;
        delete rendered[id];
        return;
    }
    
    const audio = elemDiv.querySelector('audio');
    const video = elemDiv.querySelector('video');
    if (audio) { audio.pause(); audio.currentTime = 0; }
    if (video) { video.pause(); video.currentTime = 0; }
    
    if (elem && elem.transition && elem.transition !== "none") {
        hiding[id] = true;
        elemDiv.className = elemDiv.className.replace(/\btrans-[\w-]+\b/g, '').trim() + ' trans-' + elem.transition + '-out';
        elemDiv.style.animationDuration = (elem.transitionDuration || 0.5) + 's';
        setTimeout(() => {
            visible[id] = false;
            hiding[id] = false;
            delete rendered[id];
            if (elemDiv.parentNode) elemDiv.remove();
        }, (elem.transitionDuration || 0.5) * 1000);
    } else {
        visible[id] = false;
        delete rendered[id];
        elemDiv.remove();
    }
}

function showElem(id) {
    if (visible[id] && rendered[id]) return;
    visible[id] = true;
    const s = STEPS.find(x => x.id === current);
    const elem = s.elements.find(e => e.id === id);
    if (elem) {
        if (elem.type === "timer") startTimer(id, elem.countdown);
        if (elem.duration && elem.duration > 0) {
            const t = setTimeout(() => hideElem(id), elem.duration * 1000);
            timers.push(t);
        }
        addElement(elem, true);
    }
}

function checkCond(c) {
    if (!c) return true;
    if (c.type === "hasItem") return inventory.includes(c.item);
    if (c.type === "notHasItem") return !inventory.includes(c.item);
    return true;
}

function exec(acts) {
    acts.forEach(a => {
        if (a.type === "show" || a.type === "showDelay") {
            const delay = (a.type === "showDelay" && a.delay) ? a.delay * 1000 : 0;
            const targets = a.targets && a.targets.length > 0 ? a.targets : [a.target];
            targets.forEach(t => { if (t) setTimeout(() => showElem(t), delay); });
        } else if (a.type === "hide" || a.type === "hideDelay") {
            const delay = (a.type === "hideDelay" && a.delay) ? a.delay * 1000 : 0;
            const targets = a.targets && a.targets.length > 0 ? a.targets : [a.target];
            targets.forEach(t => { if (t) setTimeout(() => hideElem(t), delay); });
        } else if (a.type === "goto") {
            if (a.targets && a.targets.length > 0) current = a.targets[Math.floor(Math.random() * a.targets.length)];
            else if (a.target) current = a.target;
            render();
            return;
        } else if (a.type === "addItem" && !inventory.includes(a.target)) inventory.push(a.target);
        else if (a.type === "removeItem") inventory = inventory.filter(x => x !== a.target);
    });
    updateInventory();
}

function createElemHTML(e, withTransition) {
    const isHiding = hiding[e.id];
    const transClass = withTransition && e.transition && e.transition !== "none" && !isHiding ? " trans-" + e.transition : (isHiding ? " trans-" + e.transition + "-out" : "");
    const transDur = e.transitionDuration || 0.5;
    const style = "left:" + e.x + "px;top:" + e.y + "px;width:" + e.width + "px;height:" + e.height + "px;z-index:" + e.layer + (e.shape === "circle" ? ";border-radius:50%" : "") + ";animation-duration:" + transDur + "s";
    const mousedown = e.type === "draggable" ? ' onmousedown="handleDragStart(event, \'' + e.id + '\')"' : "";
    const click = (e.type === "button" || (e.type === "hotspot" && e.hotspotMode !== "drop")) ? ' onclick="handleClick(\'' + e.id + '\')"' : "";
    const hotspotClass = (e.type === "hotspot" && e.showInGame) ? " elem-hotspot-visible" : "";
    
    let h = '<div class="elem' + (e.type === "draggable" ? " elem-draggable" : "") + hotspotClass + transClass + '" data-elem-id="' + e.id + '" style="' + style + '"' + mousedown + click + '>';
    if (e.type === "image" && e.content) h += '<img src="' + e.content + '">';
    if (e.type === "video" && e.content) h += '<video ' + (e.autoplay ? 'autoplay ' : '') + (e.loop ? 'loop' : '') + '><source src="' + e.content + '"></video>';
    if (e.type === "text") h += '<div class="elem-text" style="font-size:' + (e.textSize || 24) + 'px;color:' + (e.textColor || "#ffffff") + ';background:' + (e.textBgColor || "rgba(0,0,0,0.8)") + '">' + e.content + '</div>';
    if (e.type === "button") h += '<div class="elem-button" style="background:' + e.color + '">' + (e.content || "Button") + '</div>';
    if (e.type === "audio" && e.content) h += '<audio ' + (e.autoplay ? 'autoplay ' : '') + (e.loop ? 'loop' : '') + '><source src="' + e.content + '"></audio>';
    if (e.type === "timer") h += '<div class="elem-timer">' + (timerCountdowns[e.id] !== undefined ? timerCountdowns[e.id] : e.countdown) + '</div>';
    if (e.type === "draggable") {
        if (e.contentType === "image" && e.content) h += '<img src="' + e.content + '">';
        else h += '<div style="font-size:' + e.fontSize + 'px;color:#fff;pointer-events:none">' + (e.content || "ðŸ“¦") + '</div>';
    }
    h += '</div>';
    return h;
}

function addElement(e, withTransition) {
    if (!e || rendered[e.id]) return;
    const game = document.getElementById("game");
    const s = STEPS.find(x => x.id === current);
    const temp = document.createElement('div');
    temp.innerHTML = createElemHTML(e, withTransition);
    const newElem = temp.firstChild;
    
    const existingElems = Array.from(game.querySelectorAll('[data-elem-id]'));
    let inserted = false;
    for (const existing of existingElems) {
        const existingE = s.elements.find(el => el.id === existing.getAttribute('data-elem-id'));
        if (existingE && existingE.layer > e.layer) {
            game.insertBefore(newElem, existing);
            inserted = true;
            break;
        }
    }
    if (!inserted) game.appendChild(newElem);
    rendered[e.id] = true;
}

function fullDraw() {
    const s = STEPS.find(x => x.id === current);
    const game = document.getElementById("game");
    game.style.background = s.bgColor || "#000";
    let h = "";
    
    if (s.bgShapes) {
        s.bgShapes.forEach(sh => {
            h += '<div style="position:absolute;left:' + sh.x + 'px;top:' + sh.y + 'px;width:' + sh.width + 'px;height:' + sh.height + 'px;background:' + sh.color + ';border-radius:' + (sh.type === "circle" ? "50%" : "0") + ';z-index:0"></div>';
        });
    }
    
    s.elements.filter(e => visible[e.id] || hiding[e.id]).sort((a, b) => a.layer - b.layer).forEach(e => {
        h += createElemHTML(e, true);
        rendered[e.id] = true;
    });
    
    game.innerHTML = h;
    updateInventory();
}

function updateInventory() {
    const inv = document.getElementById("inventory");
    const visInv = inventory.filter(item => {
        const invItem = INVENTORY_ITEMS.find(i => (i.name || i) === item);
        return !invItem || (typeof invItem === "string") || invItem.visible;
    });
    if (visInv.length > 0) {
        inv.style.display = "flex";
        inv.innerHTML = visInv.map(x => '<div style="width:40px;height:40px;background:#f7931a;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px">' + x[0] + '</div>').join("");
    } else {
        inv.style.display = "none";
    }
}

function handleDragStart(ev, elemId) {
    ev.preventDefault();
    const s = STEPS.find(x => x.id === current);
    const elem = s.elements.find(e => e.id === elemId);
    if (!elem) return;
    draggedElem = elem;
    const rect = ev.target.getBoundingClientRect();
    const canvas = document.getElementById("game");
    const canvasRect = canvas.getBoundingClientRect();
    dragOffset.x = ev.clientX - rect.left;
    dragOffset.y = ev.clientY - rect.top;
    dragPos.x = ev.clientX - canvasRect.left;
    dragPos.y = ev.clientY - canvasRect.top;
    document.addEventListener('mousemove', handleDragMove);
    document.addEventListener('mouseup', handleDragEnd);
}

function handleDragMove(ev) {
    if (!draggedElem) return;
    ev.preventDefault();
    const canvas = document.getElementById("game");
    const rect = canvas.getBoundingClientRect();
    dragPos.x = ev.clientX - rect.left;
    dragPos.y = ev.clientY - rect.top;
    const draggedDiv = document.querySelector('[data-elem-id="' + draggedElem.id + '"]');
    if (draggedDiv) {
        draggedDiv.style.left = (dragPos.x - dragOffset.x) + 'px';
        draggedDiv.style.top = (dragPos.y - dragOffset.y) + 'px';
    }
}

function handleDragEnd(ev) {
    if (!draggedElem) return;
    const s = STEPS.find(x => x.id === current);
    const canvas = document.getElementById("game");
    const rect = canvas.getBoundingClientRect();
    const dropX = ev.clientX - rect.left;
    const dropY = ev.clientY - rect.top;
    s.elements.filter(e => e.type === "hotspot" && visible[e.id] && e.hotspotMode !== "click").forEach(h => {
        if (dropX >= h.x && dropX <= h.x + h.width && dropY >= h.y && dropY <= h.y + h.height) {
            s.events.forEach(ev => {
                if (ev.trigger.type === "onDrop" && ev.trigger.sourceElement === h.id && checkCond(ev.condition)) exec(ev.actions);
            });
        }
    });
    document.removeEventListener('mousemove', handleDragMove);
    document.removeEventListener('mouseup', handleDragEnd);
    const draggedDiv = document.querySelector('[data-elem-id="' + draggedElem.id + '"]');
    if (draggedDiv) {
        draggedDiv.style.left = draggedElem.x + 'px';
        draggedDiv.style.top = draggedElem.y + 'px';
    }
    draggedElem = null;
}

function handleClick(id) {
    const s = STEPS.find(x => x.id === current);
    s.events.forEach(ev => {
        if (ev.trigger.type === "onClick" && ev.trigger.sourceElement === id && checkCond(ev.condition)) exec(ev.actions);
    });
}

render();
    </script>
</body>
</html>
